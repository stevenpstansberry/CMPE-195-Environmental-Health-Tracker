<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="">
	<meta name="keywords" content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="shortcut icon" href="../static/img/icons/icon-48x48.png" />

	<title>Analysis Page | Eco Health Tracker</title>

	<link href="../static/css/app.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
</head>

<body>
	<div class="wrapper">
		<nav id="sidebar" class="sidebar js-sidebar">
			<div class="sidebar-content js-simplebar">
				<a class="sidebar-brand" href="../dashboard">
          <span class="align-middle">Eco Health Tracker</span>
		</a>

		<ul class="sidebar-nav">
			<li class="sidebar-header">
				Pages
			</li>

			<li class="sidebar-item">
				<a class="sidebar-link" href="../dashboard">
	  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Dashboard</span>
			</a>
					</li>

					<li class="sidebar-item active">
						<a class="sidebar-link" href="../analysis">
				<i class="align-middle" data-feather="book"></i> <span class="align-middle">Analysis</span>
			</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="">
			<i class="align-middle" data-feather="user"></i> <span class="align-middle">Profile</span>
			</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="../sign_in">
			<i class="align-middle" data-feather="log-in"></i> <span class="align-middle">Sign In</span>
			</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="../sign_up">
			<i class="align-middle" data-feather="user-plus"></i> <span class="align-middle">Sign Up</span>
			</a>
					</li>
				</ul>
			</div>
		</nav>

		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg">
				<a class="sidebar-toggle js-sidebar-toggle">
          <i class="hamburger align-self-center"></i>
        </a>
				<div class="navbar-collapse collapse">
					<ul class="navbar-nav navbar-align">
						<li class="nav-item dropdown">
							<a class="nav-icon dropdown-toggle" href="#" id="alertsDropdown" data-bs-toggle="dropdown">
								<div class="position-relative">
									<i class="align-middle" data-feather="bell"></i>
									<span class="indicator">2</span>
								</div>
							</a>
							<div class="dropdown-menu dropdown-menu-lg dropdown-menu-end py-0" aria-labelledby="alertsDropdown">
								<div class="dropdown-menu-header">
									2 New Notifications
								</div>
								<div class="list-group">
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<i class="text-danger" data-feather="alert-circle"></i>
											</div>
											<div class="col-10">
												<div class="text-dark">Sensor Offline</div>
												<div class="text-muted small mt-1">Please check the sensor connectivity.</div>
												<div class="text-muted small mt-1">30m ago</div>
											</div>
										</div>
									</a>
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<i class="text-warning" data-feather="bell"></i>
											</div>
											<div class="col-10">
												<div class="text-dark">New Function Update</div>
												<div class="text-muted small mt-1">Check out our new function!</div>
												<div class="text-muted small mt-1">2h ago</div>
											</div>
										</div>
									</a>
								</div>
								<div class="dropdown-menu-footer">
									<a href="#" class="text-muted">Show all notifications</a>
								</div>
							</div>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-icon dropdown-toggle d-inline-block d-sm-none" href="#" data-bs-toggle="dropdown">
                <i class="align-middle" data-feather="settings"></i>
              </a>

							<a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#" data-bs-toggle="dropdown">
                <img src="../static/img/avatars/avatar.jpg" class="avatar img-fluid rounded me-1" alt="Charles Hall" /> <span class="text-dark">Charles Hall</span>
              </a>
							<div class="dropdown-menu dropdown-menu-end">
								<a class="dropdown-item" href=""><i class="align-middle me-1" data-feather="user"></i> Profile</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href=""><i class="align-middle me-1" data-feather="settings"></i> Settings & Privacy</a>
								<a class="dropdown-item" href=""><i class="align-middle me-1" data-feather="help-circle"></i> Help Center</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="">Log out</a>
							</div>
						</li>
					</ul>
				</div>
			</nav>

			<main class="content">
				<div class="container-fluid p-0">
					<h1 class="h3 mb-3"><strong>Analysis</strong></h1>
					<!-- Switching Buttons for Weekly/Monthly Analysis -->
                    <div class="btn-group" role="group" aria-label="Switch Analysis">
                        <button type="button" class="btn btn-primary" id="weeklyBtn">Weekly</button>
                        <button type="button" class="btn btn-primary" id="monthlyBtn">Monthly</button>
                    </div>
                    <!-- Arrow Buttons for Navigating Weeks/Months -->
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <button type="button" class="btn btn-outline-primary" id="prevBtn"><<</button>
                        <p class="mb-0" id="dateDisplay">Week: 2024-04-14</p> <!-- Display current week -->
                        <button type="button" class="btn btn-outline-primary" id="nextBtn">>></button>
                    </div>
                    <!-- Weekly Data Analysis Row -->
                    <div class="row mt-3">
                        <!-- Horizontal Button Group for Data Types -->
                        <div class="col-12">
                            <div class="btn-group" role="group" aria-label="Data Type">
                                <button type="button" class="btn btn-secondary active" id="tempBtn">Temperature</button>
                                <button type="button" class="btn btn-secondary" id="humBtn">Humidity</button>
                                <button type="button" class="btn btn-secondary" id="pressBtn">Pressure</button>
                                <button type="button" class="btn btn-secondary" id="aqBtn">Air Quality</button>
                            </div>
                        </div>
                        <!-- Left Part: Week's Average Data and Line Chart -->
                        <div class="col-md-6" id="weeklyLeft">
                            <!-- Card for Week's Average Data -->
                            <div class="card mb-3" id="avgCard">
                                <div class="card-body">
                                    <h5 class="card-title">Weekly Average Data</h5>
                                    <!-- Display average data here -->
									<h3 class="card-text" id="avgDataText"></h3>
                                </div>
                            </div>
                            <!-- Line Chart for Weekly Average Trend -->
                            <div class="chart chart-sm">
                                <canvas id="avgLineChart"></canvas>
                            </div>
                        </div>
                        <!-- Right Part: Highest and Lowest Data Cards and Line Chart -->
                        <div class="col-md-6" id="weeklyRight">
							<div class="row">
                            	<!-- Card for Highest Data -->
								<div class="col-md-6">
									<div class="card mb-3">
										<div class="card-body">
											<h5 class="card-title">Highest Data</h5>
											<!-- Display highest data here -->
											<h3 class="card-text" id="highDataText"></h3>
										</div>
									</div>
								</div>
								<!-- Card for Lowest Data -->
								<div class="col-md-6">
									<div class="card mb-3">
										<div class="card-body">
											<h5 class="card-title">Lowest Data</h5>
											<!-- Display lowest data here -->
											<h3 class="card-text" id="lowDataText"></h3>
										</div>
									</div>
								</div>
								<!-- Line Chart for Highest and Lowest Trends -->
								<div class="chart chart-sm">
									<canvas id="highLowLineChart"></canvas>
								</div>
							</div>
                        </div>
                    </div>
                    <!-- Additional Row for Dew Point and Heat Index Analysis -->
                    <div class="row mt-5">
                        <!-- Left Part: Week's Average Dew Point and Line Chart -->
                        <div class="col-md-6">
                            <!-- Card for Week's Average Dew Point -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Weekly Average Dew Point</h5>
                                    <h3 class="card-text" id="avgDewPointText"></h3>
                                </div>
                            </div>
                            <!-- Line Chart for Weekly Dew Point Trend -->
                            <div class="chart chart-sm">
                                <canvas id="weeklyDewPointChart"></canvas>
                            </div>
                        </div>
                        <!-- Right Part: Week's Average Heat Index and Line Chart -->
                        <div class="col-md-6">
                            <!-- Card for Week's Average Heat Index -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Weekly Average Heat Index</h5>
                                    <h3 class="card-text" id="avgHeatIndexText"></h3>
                                </div>
                            </div>
                            <!-- Line Chart for Weekly Heat Index Trend -->
                            <div class="chart chart-sm">
                                <canvas id="weeklyHeatIndexChart"></canvas>
                            </div>
                        </div>
                    </div>
				</div>
			</main>

			<footer class="footer">
				<div class="container-fluid">
					<div class="row text-muted">
						<div class="col-6 text-start">
							<p class="mb-0">
								<a class="text-muted" href="" target=""><strong>Eco Health Tracker</strong></a> &copy;
							</p>
						</div>
						<div class="col-6 text-end">
							<ul class="list-inline">
								<li class="list-inline-item">
									<a class="text-muted" href="" target="">Help</a>
								</li>
								<li class="list-inline-item">
									<a class="text-muted" href="" target="_blank">Terms</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</footer>
		</div>
	</div>

	<script src="../static/js/app.js"></script>

	<script>
		document.addEventListener("DOMContentLoaded", function() {
			var week_avg_data = JSON.parse('{{ week_avg_data | tojson | safe }}');
			var week_high_data = JSON.parse('{{ week_high_data | tojson | safe }}');
			var week_low_data = JSON.parse('{{ week_low_data | tojson | safe }}');
			var week = Object.keys(week_avg_data)[Object.keys(week_avg_data).length-1]; // Default week
			var dataType = "temperature"; // Default data type

			// Define variables for chart data
			var weekLabels = ["Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat"];
			var ctx = document.getElementById("avgLineChart").getContext("2d");
			var highLowCtx = document.getElementById("highLowLineChart").getContext("2d");
			var gradient = ctx.createLinearGradient(0, 0, 0, 225);
			gradient.addColorStop(0, "rgba(215, 227, 244, 1)");
			gradient.addColorStop(1, "rgba(215, 227, 244, 0)");

			// Data for average line chart
			var avgLineChart = new Chart(ctx, {
				type: 'line',
				data: {
					labels: weekLabels,
					datasets: [{
						label: "Average " + dataType,
						data: week_avg_data[week][dataType],
						backgroundColor: gradient,
						borderColor: window.theme.primary,
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						y: {
							beginAtZero: true
						}
					}
				}
			});

			// Data for high/low line chart
			var highLowLineChart = new Chart(highLowCtx, {
				type: 'line',
				data: {
					labels: weekLabels,
					datasets: [{
						label: 'Highest ' + dataType,
						data: week_high_data[week][dataType],
						backgroundColor: 'rgba(255, 99, 132, 0.2)',
						borderColor: 'rgba(255, 99, 132, 1)',
						borderWidth: 1
					}, {
						label: 'Lowest ' + dataType,
						data: week_low_data[week][dataType],
						backgroundColor: 'rgba(75, 192, 192, 0.2)',
						borderColor: 'rgba(75, 192, 192, 1)',
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						y: {
							beginAtZero: true
						}
					}
				}
			});

			// Function to update the content of the cards based on selected data type
			function updateCards(dataType) {
				if (dataType == "temperature") {
					document.getElementById("avgDataText").innerHTML = calculateAverage(week_avg_data[week][dataType]).toFixed(2) + " &deg;C";
					document.getElementById("highDataText").innerHTML = Math.max(...week_high_data[week][dataType]).toFixed(2) + " &deg;C";
					document.getElementById("lowDataText").innerHTML = Math.min(...week_low_data[week][dataType]).toFixed(2) + " &deg;C";
				} else if (dataType == "humidity") {
					document.getElementById("avgDataText").innerText = calculateAverage(week_avg_data[week][dataType]).toFixed(2) + " %";
					document.getElementById("highDataText").innerText = Math.max(...week_high_data[week][dataType]).toFixed(2) + " %";
					document.getElementById("lowDataText").innerText = Math.min(...week_low_data[week][dataType]).toFixed(2) + " %";
				} else if (dataType == "pressure") {
					document.getElementById("avgDataText").innerText = calculateAverage(week_avg_data[week][dataType]).toFixed(2) + " hPa";
					document.getElementById("highDataText").innerText = Math.max(...week_high_data[week][dataType]).toFixed(2) + " hPa";
					document.getElementById("lowDataText").innerText = Math.min(...week_low_data[week][dataType]).toFixed(2) + " hPa";
				} else if (dataType == "air_quality") {
					document.getElementById("avgDataText").innerText = calculateAverage(week_avg_data[week][dataType]).toFixed(2) + " ppm";
					document.getElementById("highDataText").innerText = Math.max(...week_high_data[week][dataType]).toFixed(2) + " ppm";
					document.getElementById("lowDataText").innerText = Math.min(...week_low_data[week][dataType]).toFixed(2) + " ppm";
				}
			}

			// Function to update line chart based on selected data type
			function updateLineChart(dataType) {
				avgLineChart.data.datasets[0].data = week_avg_data[week][dataType];
				highLowLineChart.data.datasets[0].data = week_high_data[week][dataType];
				highLowLineChart.data.datasets[1].data = week_low_data[week][dataType];
				avgLineChart.update();
				highLowLineChart.update();
			}

			// Initial setup
			updateCards(dataType);
			updateLineChart(dataType);
			updateDewPointHeatIndexCards();

			// Event listener for data type buttons
			document.getElementById("tempBtn").addEventListener("click", function() {
				dataType = "temperature";
				updateCards(dataType);
				updateLineChart(dataType);
				toggleActiveButton("tempBtn");
			});

			document.getElementById("humBtn").addEventListener("click", function() {
				dataType = "humidity";
				updateCards(dataType);
				updateLineChart(dataType);
				toggleActiveButton("humBtn");
			});

			document.getElementById("pressBtn").addEventListener("click", function() {
				dataType = "pressure";
				updateCards(dataType);
				updateLineChart(dataType);
				toggleActiveButton("pressBtn");
			});

			document.getElementById("aqBtn").addEventListener("click", function() {
				dataType = "air_quality";
				updateCards(dataType);
				updateLineChart(dataType);
				toggleActiveButton("aqBtn");
			});

			// Function to toggle active button
			function toggleActiveButton(btnId) {
				var buttons = document.querySelectorAll(".btn-group button");
				buttons.forEach(function(btn) {
					if (btn.id === btnId) {
						btn.classList.add("active");
					} else {
						btn.classList.remove("active");
					}
				});
			}

			// Function to calculate the average of an array
			function calculateAverage(arr) {
				var sum = arr.reduce(function(a, b) { return a + b; }, 0);
				return sum / arr.length;
			}
			
			function updateDewPointHeatIndexCards() {
				document.getElementById("avgDewPointText").innerHTML = calculateAverage(week_avg_data[week]['dew_point']).toFixed(2) + " &deg;C";
				document.getElementById("avgHeatIndexText").innerHTML = calculateAverage(week_avg_data[week]['heat_index']).toFixed(2) + " &deg;C";
			}
		});	
	</script>
		
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			var week_avg_data = JSON.parse('{{ week_avg_data | tojson | safe }}');
			var week = Object.keys(week_avg_data)[Object.keys(week_avg_data).length-1]; // Default week
			var dataType = "temperature"; // Default data type

			// Define variables for chart data
			var weekLabels = ["Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat"];
			var dewPointCtx = document.getElementById("weeklyDewPointChart").getContext("2d");
			var heatIndrxCtx = document.getElementById("weeklyHeatIndexChart").getContext("2d");
			var gradientD = dewPointCtx.createLinearGradient(0, 0, 0, 225);
			var gradientH = heatIndrxCtx.createLinearGradient(0, 0, 0, 225);
			gradientD.addColorStop(0, "rgba(215, 227, 244, 1)");
			gradientD.addColorStop(1, "rgba(215, 227, 244, 0)");
			gradientH.addColorStop(0, "rgba(215, 227, 244, 1)");
			gradientH.addColorStop(1, "rgba(215, 227, 244, 0)");
			
			// Data for dew point chart
			var dewPointChart = new Chart(dewPointCtx, {
				type: 'line',
				data: {
					labels: weekLabels,
					datasets: [{
						label: "Average dew point",
						data: week_avg_data[week]['dew_point'],
						backgroundColor: gradientD,
						borderColor: window.theme.primary,
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						y: {
							beginAtZero: true
						}
					}
				}
			});

			// Data for heat index chart
			var heatIndexChart = new Chart(heatIndrxCtx, {
				type: 'line',
				data: {
					labels: weekLabels,
					datasets: [{
						label: "Average heat index",
						data: week_avg_data[week]['heat_index'],
						backgroundColor: gradientH,
						borderColor: window.theme.primary,
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						y: {
							beginAtZero: true
						}
					}
				}
			});
		});	
	</script>

</body>

</html>
